{
    "builders": [
      {
        "type": "docker",
        "image": "alpine",
        "commit": "true",
        "pull": "true",
        "changes": [
          "ENV PATH=/usr/lib/google-cloud-sdk/bin:$PATH"
        ]
      }
    ],
    "provisioners": [
        {
            "type": "inspec",
            "inspec_env_vars": [ "CHEF_LICENSE=accept"],
            "profile": "./pre-install-controls",
            "extra_arguments": ["-l" , "debug" , "--input", "os-release={{user `os-release`}}"]
        },
        {
            "type": "shell",
            "environment_vars": [
               "GCLOUD_VERSION={{user `gcloud_version`}}",
               "PACKER_VERSION={{user `packer_version`}}",
               "TERRAFORM_VERSION={{user `terraform_version`}}",
               "INSPEC_VERSION={{user `inspec_version`}}",
               "INSPECBIN_VERSION={{user `inspecbin_version`}}",
               "ANSIBLE_VERSION={{user `ansible_version`}}"
            ],
            "script": "install.sh"
        },
        {
            "type": "inspec",
            "inspec_env_vars": [ "CHEF_LICENSE=accept"],
            "profile": "./post-install-controls",
            "extra_arguments": ["-l", "debug"]
        }
    ],
    "post-processors": [
    [
      {
        "type": "docker-tag",
        "repository": "{{user `repo`}}",
        "tag": "{{timestamp}}.V{{user `tag`}}"
      },
      {
        "type": "docker-push",
        "ecr_login": "true",
        "aws_access_key": "{{user `aws_access_key`}}",
        "aws_secret_key": "{{user `aws_secret_key`}}",
        "aws_token": "{{user `aws_token`}}",
        "login_server": "{{user `login_server`}}"
      }
    ]
  ]
 }
